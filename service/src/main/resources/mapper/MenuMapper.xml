<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.xiaodou.mapper.MenuMapper">

    <!--
        根据权限列表查询菜单
        - 查询状态正常 (status=1) 且可见 (is_visible=1) 的菜单
        - 菜单的权限标识 (permission_code) 必须在用户拥有的权限列表 (permissions) 中
        - 或者菜单没有设置权限标识（即对所有人都可见的公共菜单）
    -->
    <select id="selectMenusByPermissions" resultType="com.xiaodou.model.Menu">
        SELECT
            id, parent_id, name, type, path, component, permission_code, icon, sort_order, status, is_visible, created_at, updated_at
        FROM
            menu
        WHERE
            status = 1 AND is_visible = 1
        AND
            (permission_code IS NULL OR permission_code = '' OR permission_code IN
                <foreach item="item" collection="permissions" open="(" separator="," close=")">
                    #{item}
                </foreach>
            )
        ORDER BY
            parent_id ASC, sort_order ASC
    </select>

</mapper>
